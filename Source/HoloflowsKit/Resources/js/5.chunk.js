(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{346:function(e,t,i){"use strict";i.r(t),i.d(t,"backupMyKeyPair",function(){return u}),i.d(t,"openWelcomePage",function(){return p});var r=i(21),n=i(6),o=i(13),a=i(43),s=i(2),c=i(10);async function u(e){await Object(o.c)(1e3);const t=await async function e(t,i=!1){const r=[],n=[],o=[],a=await Object(c.getLocalKeysDB)();if(0===a.size)return console.log("New user! Generating key pairs"),await Object(c.generateLocalKeyDB)(t),await Object(c.generateMyIdentityDB)(t),e(t,i);async function s(e){r.push({network:e.identifier.network,userId:e.identifier.userId,nickname:e.nickname,previousIdentifiers:e.previousIdentifiers,localKey:await p(a.get(e.identifier.network)[e.identifier.userId]),publicKey:await p(e.publicKey),privateKey:await p(e.privateKey)})}for(const w of await Object(c.getMyIdentitiesDB)())o.push(s(w));async function u(e){n.push({network:e.identifier.network,userId:e.identifier.userId,groups:e.groups.map(e=>({network:e.network,groupId:e.groupId,type:e.type})),nickname:e.nickname,previousIdentifiers:(e.previousIdentifiers||[]).map(e=>({network:e.network,userId:e.userId})),publicKey:await p(e.publicKey)})}if(i)for(const w of await Object(c.queryPeopleDB)(()=>!0))w.publicKey&&o.push(u(w));return await Promise.all(o),i?{version:1,whoami:r,people:n}:{version:1,whoami:r};function p(e){return crypto.subtle.exportKey("jwk",e)}}(e),i=JSON.stringify(t),r=Object(n.d)(i),a=new Blob([r],{type:"application/json"}),s=URL.createObjectURL(a),u=new Date,p=`${u.getFullYear()}-${(u.getMonth()+1).toString().padStart(2,"0")}-${u.getDate().toString().padStart(2,"0")}`;browser.downloads.download({url:s,filename:`maskbook-keystore-backup-${p}.json`,conflictAction:"prompt",saveAs:!0})}async function p(e,t){if(!Object(a.c)(e.userId))throw new TypeError(Object(s.a)("service_username_invalid"));const i=browser.runtime.getURL("index.html#/welcome?identifier="+e.toText());if(!t)return browser.tabs.create({url:i});{const[e]=await browser.tabs.query({active:!0});if(e)return browser.tabs.update(e.id,{url:i})}}Object(r.b)("background","WelcomeService")}}]);
//# sourceMappingURL=5.chunk.js.map