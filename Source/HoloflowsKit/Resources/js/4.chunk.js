(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{347:function(e,t,n){"use strict";n.r(t);var i=n(21),r=n(48),o=n(10);function a(e,t){return function(e){const t=e;return 1===t.version&&!!Array.isArray(t.whoami)&&!!t.whoami}(e)?e:function(e){const t=e;return!!(t.local&&t.key&&t.key.key&&t.key.key.privateKey&&t.key.key.publicKey)}(e)&&t?{version:1,whoami:[{localKey:e.local,network:"facebook.com",publicKey:e.key.key.publicKey,privateKey:e.key.key.privateKey,userId:t.userId||"$self"}]}:null}var c=n(5),u=n(133);async function s(e){return Object(r.d)({network:e})}async function y(e){if("string"===typeof e){const t=(await Object(o.getMyIdentitiesDB)()).filter(t=>t.identifier.network===e);return Promise.all(t.map(r.c))}{const t=await Object(o.queryMyIdentityAtDB)(e);return t?[await Object(r.c)(t)]:[]}}async function f(e,t){function n(e){return crypto.subtle.importKey("jwk",e,{name:"ECDH",namedCurve:"K-256"},!0,["deriveKey"])}function i(e){return new c.PersonIdentifier(e.network,e.userId)}function r(e){return new c.GroupIdentifier(e.network,e.groupId,e.type)}const u=a(e,t);if(!u)return!1;const s=Promise.all(u.whoami.map(async e=>{const t=i(e),r=(e.previousIdentifiers||[]).map(i);await async function(e,t){await Object(o.storeMyIdentityDB)(e);const n=await crypto.subtle.importKey("jwk",t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);await Object(o.storeLocalKeyDB)(new c.PersonIdentifier("facebook.com","$self"),n),await Object(o.storeLocalKeyDB)(e.identifier,n)}({identifier:t,groups:[],nickname:e.nickname,previousIdentifiers:r,publicKey:await n(e.publicKey),privateKey:await n(e.privateKey)},e.localKey)})),y=Promise.all((u.people||[]).map(async e=>{const t=new c.PersonIdentifier(e.network,e.userId),a=(e.groups||[]).map(r),u=(e.previousIdentifiers||[]).map(i);await Object(o.storeNewPersonDB)({identifier:t,groups:a,nickname:e.nickname,previousIdentifiers:u,publicKey:await n(e.publicKey)})}));return await s,await y,!0}async function d(e){const t=new c.PersonIdentifier("facebook.com","$unknown"),n=new c.PersonIdentifier("facebook.com","$self");{const i=(await Object(o.getMyIdentitiesDB)()).filter(e=>e.identifier.equals(t)||e.identifier.equals(n));for(const t of i)await Object(o.storeMyIdentityDB)(Object.assign({},t,{identifier:e}));Object(o.removeMyIdentityAtDB)(t),Object(o.removeMyIdentityAtDB)(n)}{const i=await Object(o.queryLocalKeyDB)("facebook.com");i&&(i.$unknown&&await Object(o.storeLocalKeyDB)(e,i.$unknown),i.$self&&await Object(o.storeLocalKeyDB)(e,i.$self),Object(o.deleteLocalKeyDB)(t),Object(o.deleteLocalKeyDB)(n))}}async function l(e,t){const{avatarURL:n,nickname:i}=t;i&&Object(o.updatePersonDB)({identifier:e,nickname:i}),n&&Object(r.f)(e,n)}n.d(t,"queryPeople",function(){return s}),n.d(t,"queryMyIdentity",function(){return y}),n.d(t,"restoreBackup",function(){return f}),n.d(t,"resolveIdentityAtFacebook",function(){return d}),n.d(t,"updatePersonInfo",function(){return l}),n.d(t,"storeAvatar",function(){return r.f}),n.d(t,"getAvatarBlobURL",function(){return r.a}),n.d(t,"queryPerson",function(){return r.e}),n.d(t,"uploadProvePostUrl",function(){return u.b}),Object(i.b)("background","FriendService")}}]);
//# sourceMappingURL=4.chunk.js.map