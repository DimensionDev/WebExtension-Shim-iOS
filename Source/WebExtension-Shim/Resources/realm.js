!function(e,t){(e=e||self).Realm=t()}(this,function(){"use strict";function e(e,t){const n=`please report internal shim error: ${e}`;throw console.error(n),t&&(console.error(`${t}`),console.error(`${t.stack}`)),n}function t(t,n){t||e(n)}function n(e){let t=`'use strict'; (${e})`;return t=(t=(t=t.replace(/\(0,\s*_[0-9a-fA-F]{3}\u200D\.e\)/g,"(0, eval)")).replace(/_[0-9a-fA-F]{3}\u200D\.g\./g,"")).replace(/cov_[^+]+\+\+[;,]/g,"")}function r(e,t){const{callAndWrapError:n}=e,{initRootRealm:r,initCompartment:o,getRealmGlobal:a,realmEvaluate:c}=t,{create:s,defineProperties:i}=Object;class u{constructor(){throw new TypeError("Realm is not a constructor")}static makeRootRealm(t={}){const o=s(u.prototype);return n(r,[e,o,t]),o}static makeCompartment(t={}){const r=s(u.prototype);return n(o,[e,r,t]),r}get global(){return n(a,[this])}evaluate(e,t,r={}){return n(c,[this,e,t,r])}}return i(u,{toString:{value:()=>"function Realm() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),i(u.prototype,{toString:{value:()=>"[object Realm]",writable:!1,enumerable:!1,configurable:!0}}),u}const o=n(r);const a=n(function(){const{getPrototypeOf:e}=Object,{apply:t}=Reflect,n=e=>(n,...r)=>t(e,n,r);return n(Map.prototype.get),n(Set.prototype.has),new Map([["EvalError",EvalError],["RangeError",RangeError],["ReferenceError",ReferenceError],["SyntaxError",SyntaxError],["TypeError",TypeError],["URIError",URIError]]),new Set([EvalError.prototype,RangeError.prototype,ReferenceError.prototype,SyntaxError.prototype,TypeError.prototype,URIError.prototype,Error.prototype]),function(e,t){return e(...t)}}),{assign:c,create:s,freeze:i,defineProperties:u,getOwnPropertyDescriptor:l,getOwnPropertyDescriptors:f,getOwnPropertyNames:p,getPrototypeOf:y,setPrototypeOf:m}=Object,{apply:d,ownKeys:b}=Reflect,h=e=>(t,...n)=>d(e,t,n),v=h(Object.prototype.hasOwnProperty),w=h(Array.prototype.filter),E=h(Array.prototype.pop),g=h(Array.prototype.join),R=h(Array.prototype.concat),O=h(RegExp.prototype.test),F=h(String.prototype.includes),S=["Infinity","NaN","undefined"],_=["isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","Array","ArrayBuffer","Boolean","DataView","EvalError","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Map","Number","Object","RangeError","ReferenceError","Set","String","Symbol","SyntaxError","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","URIError","WeakMap","WeakSet","JSON","Math","Reflect","escape","unescape"],A=["Date","Error","Promise","Proxy","RegExp","Intl"];function P(){const{defineProperty:e,defineProperties:t,getOwnPropertyDescriptor:n,getPrototypeOf:r,prototype:o}=Object;try{(0,o.__lookupGetter__)("x")}catch(e){return}function a(e){if(void 0===e||null===e)throw new TypeError("can't convert undefined or null to object");return Object(e)}function c(e){return"symbol"==typeof e?e:`${e}`}function s(e,t){if("function"!=typeof e)throw TypeError(`invalid ${t} usage`);return e}t(o,{__defineGetter__:{value:function(t,n){const r=a(this);e(r,t,{get:s(n,"getter"),enumerable:!0,configurable:!0})}},__defineSetter__:{value:function(t,n){const r=a(this);e(r,t,{set:s(n,"setter"),enumerable:!0,configurable:!0})}},__lookupGetter__:{value:function(e){let t,o=a(this);for(e=c(e);o&&!(t=n(o,e));)o=r(o);return t&&t.get}},__lookupSetter__:{value:function(e){let t,o=a(this);for(e=c(e);o&&!(t=n(o,e));)o=r(o);return t&&t.set}}})}function x(){const{defineProperties:e,getPrototypeOf:t,setPrototypeOf:n}=Object;function r(r,o){let a;try{a=(0,eval)(o)}catch(e){if(e instanceof SyntaxError)return;throw e}const c=t(a),s=c.constructor;const i=function(){if(function(){const e=(new Error).stack;return!e||-1!==e.indexOf("eval")}())throw new TypeError("Not available");return s.apply(this,arguments)};e(i,{name:{value:r}}),e(c,{constructor:{value:i}}),e(i,{prototype:{value:c}}),i!==Function.prototype.constructor&&n(i,Function.prototype.constructor)}r("Function","(function(){})"),r("GeneratorFunction","(function*(){})"),r("AsyncFunction","(async function(){})"),r("AsyncGeneratorFunction","(async function*(){})")}const j="'use strict'; this",$="(0, eval)(\"'use strict'; this\")";const I=()=>{const e=function(){if("undefined"==typeof document)return;const e=document.createElement("iframe");return e.style.display="none",document.children[0].appendChild(e),e.contentWindow.eval(j)}(),t=function(){if(new Function("try {return this===global}catch(e){return false}")())return Symbol().runInNewContext($)}();if(!e&&!t||e&&t)throw new Error("unexpected platform, unable to create Realm");return e||t};function G(e,n=[]){const r=function(e){const n={};function r(r,o,a,c){for(const s of r){const r=l(e,s);r&&(t("value"in r,`unexpected accessor on global property: ${s}`),n[s]={value:r.value,writable:o,enumerable:a,configurable:c})}}return r(S,!1,!1,!1),r(_,!1,!1,!1),r(A,!0,!1,!0),n}(e),o=e.eval,c=e.Function,s=o(a)();return i({unsafeGlobal:e,sharedGlobalDescs:r,unsafeEval:o,unsafeFunction:c,callAndWrapError:s,allShims:n})}const U=n(P),k=n(x);const D=/^[a-zA-Z_$][\w$]*$/,T=new Set(["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","yield","let","static","enum","implements","package","protected","interface","private","public","await","null","true","false","this","arguments"]);function W(e,t={}){const n=p(e);return w(n,n=>{if(n in t)return!1;if("eval"===n||T.has(n)||!O(D,n))return!1;const r=l(e,n);return!1===r.configurable&&!1===r.writable&&v(r,"value")})}const C=n(function(e,t,n={},r=!1){const{unsafeGlobal:o,unsafeEval:a}=e,{freeze:c,getOwnPropertyDescriptor:s}=Object,{get:i,set:u}=Reflect;return new Proxy(c({}),{get(e,t){throw new TypeError(`unexpected scope handler trap called: ${String(t)}`)}}),{__proto__:{},useUnsafeEvaluator:!1,get(e,r){if("symbol"!=typeof r)return"eval"===r&&!0===this.useUnsafeEvaluator?(this.useUnsafeEvaluator=!1,a):r in n?i(n,r,t):i(t,r)},set:(e,r,o)=>r in n?"value"in s(n,r)?u(n,r,o):u(n,r,o,t):u(t,r,o),has:(e,a)=>!!r||"eval"===a||a in n||a in t||a in o,getPrototypeOf:()=>null}});const N=n(function(e,t){const{callAndWrapError:n}=e,{defineProperties:r}=Object,o={eval(){return n(t,arguments)}}.eval;return r(o,{toString:{value:()=>"function eval() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),o});const M=n(function(e,t){const{callAndWrapError:n,unsafeFunction:r}=e,{defineProperties:o}=Object,a=function(){return n(t,arguments)};return o(a,{prototype:{value:r.prototype},toString:{value:()=>"function Function() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),a});const z=n(function(e,t){const{create:n,getOwnPropertyDescriptors:r}=Object,{apply:o}=Reflect;return e={src:`${(e=(e=>(t,...n)=>o(e,t,n))(Array.prototype.reduce)(t,(e,t)=>t.rewrite?t.rewrite(e):e,e={src:`${e.src}`,endowments:n(null,r(e.endowments))})).src}`,endowments:n(null,r(e.endowments))}});new RegExp("(?:\x3c!--|--\x3e)");const B={rewrite:e=>(e.src,e)};function J(e,t){const{unsafeFunction:n}=e;return n(`\n    with (arguments[0]) {\n      ${function(e){return 0===e.length?"":`const {${g(e,",")}} = this;`}(t)}\n      return function() {\n        'use strict';\n        return eval(arguments[0]);\n      };\n    }\n  `)}const K=new WeakMap;function V(e){return t(Object(e)===e,"bad object, not a Realm instance"),t(K.has(e),"Realm instance has no record"),K.get(e)}function Z(e,n){t(Object(e)===e,"bad object, not a Realm instance"),t(!K.has(e),"Realm instance already has a record"),K.set(e,n)}function q(n,r,o){const{sharedGlobalDescs:a,unsafeGlobal:c}=n,l=s(c.Object.prototype,a),f=function(t,n,r,o){const{unsafeEval:a}=t,c=a(z);return function(s={},i={}){const u=i.transforms||[],l=R(u,r||[],[B]);return function(r){let i={src:r,endowments:s};i=c(i,l);const u=W(n,i.endowments),f=W(i.endowments),p=R(u,f),y=J(t,p),m=a(C)(t,n,i.endowments,o),b=Proxy.revocable({},m),h=b.proxy,v=d(y,n,[h]);let w;m.useUnsafeEvaluator=!0;try{return d(v,n,[i.src])}catch(e){throw w=e,e}finally{m.useUnsafeEvaluator&&(b.revoke(),e("handler did not revoke useUnsafeEvaluator",w))}}}}(n,l,r,o),p=f(),m=function(e,n){const{unsafeEval:r,unsafeFunction:o}=e,a=r(N)(e,n);return t(y(a).constructor!==Function,"hide Function"),t(y(a).constructor!==o,"hide unsafeFunction"),a}(n,p),b=function(e,n){const{unsafeGlobal:r,unsafeEval:o,unsafeFunction:a}=e,c=o(M)(e,function(...e){const t=`${E(e)||""}`;let o=`${g(e,",")}`;if(!O(/^[\w\s,]*$/,o))throw new SyntaxError("shim limitation: Function arg must be simple ASCII identifiers, possibly separated by commas: no default values, pattern matches, or non-ASCII parameter names");if(new a(t),F(o,")"))throw new r.SyntaxError("shim limitation: Function arg string contains parenthesis");return o.length>0&&(o+="\n/*``*/"),n(`(function(${o}){\n${t}\n})`)});return t(y(c).constructor!==Function,"hide Function"),t(y(c).constructor!==a,"hide unsafeFunction"),c}(n,p),h=function(e){return(t,n,r={})=>e(n,r)(t)}(f);return function(e,t,n){u(e,{eval:{value:t,writable:!0,configurable:!0},Function:{value:n,writable:!0,configurable:!0}})}(l,m,b),i({safeGlobal:l,safeEval:m,safeEvalWhichTakesEndowments:h,safeFunction:b})}const H={initRootRealm:function(e,t,n){const{shims:r,transforms:a,sloppyGlobals:c}=n,s=R(e.allShims,r),i=function(e){const t=G(I(),e),{unsafeEval:n}=t;return n(U)(),n(k)(),t}(s),{unsafeEval:u}=i,l=u(o)(i,H);i.sharedGlobalDescs.Realm={value:l,writable:!0,configurable:!0};const f=q(i,a,c),{safeEvalWhichTakesEndowments:p}=f;for(const e of s)p(e);Z(t,f)},initCompartment:function(e,t,n={}){const{transforms:r,sloppyGlobals:o}=n;Z(t,q(e,r,o))},getRealmGlobal:function(e){const{safeGlobal:t}=V(e);return t},realmEvaluate:function(e,t,n={},r={}){const{safeEvalWhichTakesEndowments:o}=V(e);return o(t,n,r)}};return r(function(){const e=(0,eval)(j);return P(),x(),G(e)}(),H)});